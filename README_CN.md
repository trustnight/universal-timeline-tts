# 通用时间轴TTS播报系统

[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)
[![AutoHotkey](https://img.shields.io/badge/AutoHotkey-v2.0-blue.svg)](https://www.autohotkey.com/)

> ⚡ **本项目 99% 由 AI 制作完成**

一个功能强大的通用游戏时间轴语音播报系统，基于 AutoHotkey v2 开发。支持自动时间轴播报、OCR 智能触发、可视化倒计时等功能。

[English](README.md) | 简体中文

## 📸 功能展示

- 主界面：配置玩家信息、选择副本、控制监控
- TTS 时间轴编辑器：可视化编辑时间轴事件
- OCR 触发器配置：设置关键字触发语音提示
- 倒计时悬浮窗：实时显示即将发生的事件
- 站位配置：为不同职能分配站位

## ✨ 主要功能

### 🎤 智能语音播报
- **时间轴播报**：按预设时间自动播报技能提示
- **OCR 触发播报**：识别屏幕文字实时触发语音
- **职能过滤**：根据队伍/职能只播报相关内容
- **取反播报**：支持 `~MT` 表示"除了MT之外所有人"
- **职称组播报**：使用 T/D/H 代表坦克/输出/治疗组

### 🔍 OCR 智能识别
- **三区域监控**：独立配置台词区、血条区、技能区
- **关键字触发**：识别到关键字立即播报
- **冷却管理**：避免重复触发
- **多目标支持**：同一关键字可配置多个目标

### ⏰ 可视化倒计时
- **悬浮窗显示**：透明可拖拽的倒计时窗口
- **技能预告**：提前显示即将发生的技能
- **实时更新**：精确到秒的倒计时

### 📍 灵活站位配置
- **多目标站位**：同一技能为不同职能配置不同站位
- **变量替换**：自动替换 `{position}` 变量
- **分段站位**：支持 `{position1}` `{position2}` 等

### 🎯 自动启动监控
- **颜色检测**：检测到指定颜色自动开始监控
- **区域框选**：可视化选择检测区域
- **单次触发**：触发后自动停止，避免误触

## 🚀 快速开始

### 系统要求
- Windows 10/11
- AutoHotkey v2.0 或更高版本

### 安装步骤

1. **克隆项目**
```bash
git clone https://github.com/yourusername/universal-timeline-tts.git
```

2. **安装 AutoHotkey v2**
   - 官网下载：https://www.autohotkey.com/
   - 选择 v2.0 版本

3. **运行程序**
   - 双击 `main.ahk` 启动

### 首次使用

1. **基础配置**
   - 设置队伍：1队 / 2队
   - 设置职能：MT、ST、H1、H2、D1-D4

2. **OCR 区域配置**
   - 点击"框选区域"按钮
   - 框选游戏中的台词/血条/技能区域
   - 保存配置

3. **选择或创建副本规则**
   - 从下拉列表选择现有副本
   - 或点击"新建副本"创建新规则

4. **开始监控**
   - 按 F3 或点击"启动监控"
   - 按 F5 停止监控
   - 按 F8 显示/隐藏倒计时条

## 📖 详细教程

### 创建副本规则

#### 1. TTS 时间轴

在"TTS轴"标签页添加时间事件：

| 字段 | 说明 | 示例 |
|------|------|------|
| 时间 | 事件发生时间 | `01:30` 或 `90` |
| 技能名称 | 技能的名称 | `大招` |
| 播报内容 | TTS 播报的文字 | `{position}站位 注意躲避` |
| 职能 | 目标职能 | `MT` 或 `1队` 或 `全部` |

**支持的变量：**
- `{position}` - 完整站位
- `{position1}` - 站位第1部分
- `{position2}` - 站位第2部分
- `{team}` - 队伍

#### 2. OCR 触发器

在对应的 OCR 区域标签页（台词/血条/技能）添加触发器：

| 字段 | 说明 | 示例 |
|------|------|------|
| 关键字 | OCR 识别的文字 | `降临` |
| 播报内容 | TTS 播报的文字 | `前往{position}分摊` |
| CD(秒) | 触发冷却时间 | `5` |
| 职能 | 目标职能 | `1队` |

**同名关键字多目标配置：**
```
关键字    播报内容                    CD(秒)    职能
降临      1队前往{position}分摊        5         1队
降临      2队前往{position}分摊        5         2队
```

#### 3. 站位配置

为技能配置站位信息：

| 字段 | 说明 | 示例 |
|------|------|------|
| 技能名称 | 对应的技能 | `大招` |
| 站位 | 站位描述 | `A点` 或 `1 3 中间` |
| 目标 | 目标职能 | `MT` |

**多目标站位示例：**
```
技能名称    站位        目标
大招        A点         MT
大招        B点         ST
分摊        1点         1队
分摊        3点         2队
```

### 高级功能

#### 职能过滤

| 语法 | 说明 | 播报对象 |
|------|------|----------|
| `全部` | 全部播报 | 所有人 |
| `1队` | 1队播报 | 1队成员 |
| `2队` | 2队播报 | 2队成员 |
| `MT` | MT播报 | MT职能 |
| `T` | 坦克组 | MT + ST |
| `D` | 输出组 | D1 + D2 + D3 + D4 |
| `H` | 治疗组 | H1 + H2 |
| `~MT` | 取反 | 除了MT之外所有人 |
| `~T` | 取反组 | 除了坦克之外所有人 |

#### 站位变量

**单个站位：**
```
站位配置：A点
播报内容：前往{position}
实际播报：前往A点
```

**多段站位：**
```
站位配置：1 3 中间
播报内容：{position1} {position2} {position3}
实际播报：1 3 中间
```

**完整站位：**
```
站位配置：1 3 中间
播报内容：{position}
实际播报：1 3 中间
```

#### 自动启动监控

1. 点击"框选区域"选择检测区域
2. 点击"取色设置"选择目标颜色
3. 勾选"启用"开启自动检测
4. 设置检测间隔（建议 200-500ms）

检测到目标颜色后自动启动监控（单次有效）。

## ⌨️ 快捷键

| 快捷键 | 功能 |
|--------|------|
| F3 | 启动监控 |
| F5 | 停止监控 |
| F6 | 重置时间轴 |
| F8 | 显示/隐藏倒计时条 |

## 📁 项目结构

```
universal-timeline-tts/
├── main.ahk                    # 主程序入口
├── ahk/                        # 源代码目录
│   ├── gui/                    # 用户界面
│   ├── ocr/                    # OCR 识别
│   ├── timeline/               # 时间轴控制
│   ├── tts/                    # 语音播报
│   ├── overlay/                # 悬浮窗
│   ├── lib/                    # 工具库
│   └── tools/                  # 辅助工具
├── config/                     # 配置文件
│   ├── app_config.json         # 主配置（自动生成）
│   └── app_config_example.json # 配置模板
├── dungeon_rules/              # 副本规则目录
│   └── example.json            # 示例规则
├── libs/                       # 第三方库
│   └── rapidocr/              # OCR 引擎
├── logs/                       # 日志文件
├── README.md                   # 英文说明
├── README_CN.md                # 中文说明
├── LICENSE                     # 开源协议
└── .gitignore                  # Git 忽略文件
```

## 🎮 应用场景

### 适用游戏类型
- **MMORPG**：副本时间轴、技能提示
- **音游**：节奏提示、combo 提醒
- **动作游戏**：BOSS 技能预警
- **其他**：任何需要时间提示的场景

### 实际应用
只需配置：
1. OCR 识别区域（识别游戏文字）
2. 时间轴事件（预设的技能时间）
3. 触发关键字（特定文字触发）

就能实现智能语音提示！

## 🔧 配置文件

### 主配置文件

`config/app_config.json`（首次运行自动生成）

```json
{
    "player": {
        "party": "1",           // 队伍：1/2/all
        "role": "mt"            // 职能：mt/st/h1/h2/d1/d2/d3/d4/all
    },
    "game": {
        "window_title": "游戏窗口标题"
    },
    "ocr": {
        "check_interval": 0.3,  // OCR 检测间隔（秒）
        "boss_dialogue": {...}, // 台词区坐标
        "boss_hp": {...},       // 血条区坐标
        "boss_skill": {...}     // 技能区坐标
    },
    "tts": {
        "enabled": true,        // 启用 TTS
        "rate": 1,              // 语速（-10 到 10）
        "volume": 80            // 音量（0 到 100）
    }
}
```

### 副本规则文件

`dungeon_rules/*.json`

```json
{
    "dungeon_name": "副本名称",
    "description": "副本描述",
    "timeline": [               // TTS 时间轴
        {
            "time": 30,
            "skill_name": "技能名",
            "tts_template": "播报内容",
            "target": "目标职能"
        }
    ],
    "overlay_timeline": [...],  // 倒计时条时间轴
    "positions": {...},         // 站位配置
    "boss_dialogue": {...},     // 台词触发器
    "boss_hp": {...},           // 血条触发器
    "boss_skill": {...}         // 技能触发器
}
```

## ❓ 常见问题

### Q: OCR 识别不准确怎么办？
A: 
1. 确保框选区域准确，只包含需要识别的文字
2. 游戏分辨率和字体大小影响识别准确度
3. 关键字设置简短一些，如"陨石"而不是"陨石降临"

### Q: TTS 没有声音？
A: 
1. 检查系统音量和 TTS 音量设置
2. 在配置中调整 TTS 引擎
3. 测试 Windows 语音合成是否正常

### Q: 时间轴不准确？
A: 
1. 按 F6 重置时间轴
2. 调整事件时间（考虑网络延迟）
3. 使用 OCR 触发作为补充

### Q: 如何备份配置？
A: 
复制以下文件/文件夹：
- `config/app_config.json`
- `dungeon_rules/` 目录

## 🤝 贡献

本项目主要由 AI 开发完成，欢迎：
- 提交 Bug 报告
- 功能建议
- 代码优化
- 文档改进
- 副本规则分享

### 提交副本规则

如果你创建了新的副本规则，欢迎提交 PR：
1. Fork 本项目
2. 在 `dungeon_rules/` 添加你的规则文件
3. 提交 Pull Request

## 📝 更新日志

### v1.0.0 (2025-01)
- ✨ 首次发布
- 🎤 TTS 时间轴播报
- 🔍 OCR 智能触发
- ⏰ 倒计时悬浮窗
- 📍 站位配置系统
- 🎯 自动启动监控

## 📄 开源协议

本项目采用 [MIT License](LICENSE) 开源协议。

## 🙏 致谢

- **AI Assistant** - 主要开发者（99% 代码由 AI 完成）🤖
- [AutoHotkey v2](https://www.autohotkey.com/) - 强大的脚本语言
- [RapidOCR](https://github.com/RapidAI/RapidOCR) - 高性能 OCR 引擎

## 📮 联系方式

- 提交 Issue：[GitHub Issues](https://github.com/yourusername/universal-timeline-tts/issues)
- 讨论交流：[GitHub Discussions](https://github.com/yourusername/universal-timeline-tts/discussions)

---

⭐ 如果觉得有用，请给个 Star！

💬 有问题欢迎提 Issue！

🚀 欢迎贡献你的副本规则！

